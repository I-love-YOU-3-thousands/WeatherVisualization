(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"1c02":function(e,t,a){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=s(a("a34a")),n=i(a("f063"));function r(){if("function"!==typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}function i(e){if(e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=o?Object.getOwnPropertyDescriptor(e,n):null;i&&(i.get||i.set)?Object.defineProperty(a,n,i):a[n]=e[n]}return a.default=e,t&&t.set(e,a),a}function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t,a,o,n,r,i){try{var s=e[r](i),l=s.value}catch(c){return void a(c)}s.done?t(l):Promise.resolve(l).then(o,n)}function c(e){return function(){var t=this,a=arguments;return new Promise((function(o,n){var r=e.apply(t,a);function i(e){l(r,o,n,i,s,"next",e)}function s(e){l(r,o,n,i,s,"throw",e)}i(void 0)}))}}var u=getApp(),f={data:function(){return{location:"",lngLat:"",weatherInfo:{},airInfo:{},data24Hours:[],minsRain:{}}},onShow:function(){var t=this;return c(o.default.mark((function a(){var n,r;return o.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(e.hideHomeButton(),!e.getStorageSync("lngLat")){a.next=12;break}t.lngLat=e.getStorageSync("lngLat"),t.location=e.getStorageSync("location"),t.getNowWeather(),t.getNowAirQuality(),t.showCharts1(),t.showCharts2(),t.showCharts3(),t.showCharts4(),a.next=23;break;case 12:return a.next=14,t.getLocationWx();case 14:n=a.sent,t.lngLat=n,r=t.getNowWeather(),t.location=r,t.getNowAirQuality(),t.showCharts1(),t.showCharts2(),t.showCharts3(),t.showCharts4();case 23:case"end":return a.stop()}}),a)})))()},onPullDownRefresh:function(){e.getStorageSync("lngLat")?(this.lngLat=e.getStorageSync("lngLat"),this.location=e.getStorageSync("location"),this.getNowWeather(),this.getNowAirQuality(),this.showCharts1(),this.showCharts2(),this.showCharts3(),this.showCharts4()):(this.lngLat=this.getLocationWx(),this.location=this.getNowWeather(),this.getNowAirQuality(),this.showCharts1(),this.showCharts2(),this.showCharts3(),this.showCharts4()),e.stopPullDownRefresh()},methods:{getLocationWx:function(){return new Promise((function(t,a){e.authorize({scope:"scope.userLocation",success:function(){e.getLocation({type:"wgs84",success:function(e){var a=e.longitude,o=e.latitude,n=a+","+o;t(n)}})},fail:function(){e.getSetting({success:function(a){var o=a.authSetting;o["scope.userLocation"]||e.showModal({title:"您未开启地理位置授权",content:"你的位置信息仅用于小程序天气展示",success:function(a){a.confirm?e.openSetting():(console.log("用户拒绝提供位置信息"),t(null))}})}})}})}))},getNowWeather:function(){var t=this;return new Promise((function(a){var o=t,n="https://free-api.heweather.net/s6/weather/now?location="+o.lngLat+"&key="+u.globalData.key;e.request({url:n,success:function(t){o.weatherInfo=t.data.HeWeather6[0],e.getStorageSync("location")&&(o.weatherInfo.basic.location=e.getStorageSync("location"));var n=o.weatherInfo.basic.location;console.log("地理位置:"+n),a(n)}})}))},getNowAirQuality:function(){var t=this;return new Promise((function(a){var o=t,n="https://devapi.qweather.com/v7/air/now?location="+o.lngLat+"&key="+u.globalData.key;e.request({url:n,success:function(e){if(200==e.data.code){o.airInfo=e.data;var t=e.data.now;a([{name:"PM10    ",value:parseFloat(t.pm10),unit:"μg/m3"},{name:"PM2.5   ",value:parseFloat(t.pm2p5),unit:"μg/m3"},{name:"臭氧浓度",value:parseFloat(t.o3),unit:"μg/m3"},{name:"二氧化氮",value:parseFloat(t.no2),unit:"μg/m3"},{name:"二氧化硫",value:parseFloat(t.so2),unit:"μg/m3"}])}else console.log("获取空气指数数据失败")}})}))},get24hoursData:function(){var t=this;return new Promise((function(a){var o=t,n="https://devapi.qweather.com/v7/weather/24h?location="+o.lngLat+"&key="+u.globalData.key;e.request({url:n,success:function(e){if(200==e.data.code){for(var t={date:[],data1:[],data2:[],data3:[]},o=0;o<e.data.hourly.length;o++){var n=e.data.hourly[o].fxTime.split("T")[1].split("+")[0].split(":")[0];t.date.push(n),t.data1.push(parseInt(e.data.hourly[o].temp)),t.data2.push(parseFloat(e.data.hourly[o].precip)),t.data3.push(parseInt(e.data.hourly[o].pop))}a(t)}else a(null),console.log("请求12小时数据失败")}})}))},getWeatherIndex:function(){var t=this;return new Promise((function(a){var o=t,n="https://devapi.qweather.com/v7/indices/1d?type=1,3,8,9,14,15,16,10&location="+o.lngLat+"&key="+u.globalData.key,r=[];e.request({url:n,success:function(e){if(200==e.data.code){for(var t={},o=0;o<e.data.daily.length;o++)"空气污染扩散条件指数"!=e.data.daily[o].name?r.push({name:e.data.daily[o].name,value:parseInt(e.data.daily[o].level)}):t={name:e.data.daily[o].name,value:parseInt(e.data.daily[o].level)};r.push(t),console.log("生活指数数据生成，正在返回.."),a(r)}else console.log("3.生活指数数据请求失败")}})}))},getNowAQI:function(){var t=this;return new Promise((function(a){var o=t,n="https://devapi.qweather.com/v7/air/now?location="+o.lngLat+"&key="+u.globalData.key,r=[];e.request({url:n,success:function(e){if(200==e.data.code){e.data.now;r.push(aqi),console.log("空气质量数据生成，正在返回.."),a(r)}else console.log("4.空气质量数据请求失败")}})}))},getMinsRian:function(){var t=this;return new Promise((function(a){var o=t,n="https://devapi.qweather.com/v7/minutely/5m?location="+o.lngLat+"&key="+u.globalData.key,r=[],i=[];e.request({url:n,success:function(e){if(200==e.data.code){var t=e.data.minutely;o.minsRain.summary=e.data.summary;for(var n=0;n<t.length;n++)r.push(t[n].fxTime.split("T")[1].split("+")[0]),i.push(parseFloat(t[n].precip));console.log("降雨量数据生成，正在返回.."),a({fxTime:r,precip:i})}else console.log("2.降雨量数据请求失败")}})}))},changeCity:function(){e.redirectTo({url:"../city/city"})},toCover:function(){e.redirectTo({url:"../cover/cover"})},showCharts1:function(){var e=this;return c(o.default.mark((function t(){var a,r;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.get24hoursData();case 2:a=t.sent,r=["#9E87FF","#73DDFF","#fe9a8b","#F56948","#9E87FF"],e.$refs.chart1.init((function(e){var t=e.canvas,o=n.init(t,null,e),i=a.date,s=a.data1,l=a.data2,c=a.data3,u=["温度(℃)","降雨量(mm)","降雨概率(%)"],f={backgroundColor:"#fff",title:{text:"气温变化曲线",textStyle:{fontSize:12,fontWeight:400},left:"center",top:"5%",show:!1},legend:{x:"center",y:"top",show:!0,top:"5%",right:"5%",itemWidth:6,itemGap:20,textStyle:{color:"#556677"},data:u},tooltip:{trigger:"axis",triggerOn:"mousemove|click",axisPointer:{label:{formatter:"时间: {value}时00分",backgroundColor:"#fff",color:"#556677",borderColor:"rgba(0,0,0,0)",shadowColor:"rgba(0,0,0,0)",shadowOffsetY:0},lineStyle:{width:0}},backgroundColor:"#fff",textStyle:{color:"#5c6c7c"},padding:[10,10],extraCssText:"box-shadow: 1px 0 2px 0 rgba(163,163,163,0.5)"},grid:{top:"15%",y2:88},dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}],xAxis:[{type:"category",name:"时",data:i,axisLine:{show:!0,lineStyle:{color:"#DCE2E8"}},axisTick:{show:!0},axisLabel:{interval:"auto",textStyle:{color:"#556677"},fontSize:12,margin:15},axisPointer:{label:{padding:[0,0,10,0],margin:15,fontSize:12,backgroundColor:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#fff"},{offset:.86,color:"#fff"},{offset:.86,color:"#33c0cd"},{offset:1,color:"#33c0cd"}],global:!1}}},splitLine:{show:!0,lineStyle:{type:"dashed"}},boundaryGap:!1}],yAxis:[{type:"value",name:"",axisTick:{show:!1},axisLine:{show:!0,lineStyle:{color:"#DCE2E8"}},axisLabel:{textStyle:{color:"#556677"}},splitLine:{show:!0,lineStyle:{type:"dashed"}}}],series:[{name:u[0],type:"line",data:s,symbolSize:1,symbol:"circle",smooth:!0,yAxisIndex:0,showSymbol:!1,emphasis:{focus:"series"},lineStyle:{width:5,shadowColor:"rgba(158,135,255, 0.3)",shadowBlur:10,shadowOffsetY:20},itemStyle:{normal:{color:r[0],borderColor:r[0]}},markPoint:{symbol:"pin",symbolSize:50,itemStyle:{borderColor:"#000",borderWidth:0,borderType:"solid"},data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},markLine:{data:[{type:"average",name:"平均值"}]}},{name:u[1],type:"line",data:l,symbolSize:1,symbol:"circle",smooth:!0,yAxisIndex:0,showSymbol:!1,emphasis:{focus:"series"},lineStyle:{width:5,color:new n.graphic.LinearGradient(1,1,0,0,[{offset:0,color:"#73DD39"},{offset:1,color:"#73DDFF"}]),shadowColor:"rgba(115,221,255, 0.3)",shadowBlur:10,shadowOffsetY:20},itemStyle:{normal:{color:r[1],borderColor:r[1]}},markPoint:{symbol:"pin",symbolSize:50,itemStyle:{color:"#4587E7",borderColor:"#000",borderWidth:0,borderType:"solid"},data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},markLine:{data:[{type:"average",name:"平均值"}]}},{name:u[2],type:"line",data:c,symbolSize:1,yAxisIndex:0,symbol:"circle",smooth:!0,showSymbol:!1,emphasis:{focus:"series"},lineStyle:{width:5,color:new n.graphic.LinearGradient(0,0,1,0,[{offset:0,color:"#fe9a"},{offset:1,color:"#fe9a8b"}]),shadowColor:"rgba(254,154,139, 0.3)",shadowBlur:10,shadowOffsetY:20},itemStyle:{normal:{color:r[2],borderColor:r[2]}},markPoint:{symbol:"pin",symbolSize:50,itemStyle:{borderColor:"#000",borderWidth:0,borderType:"solid"},data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},markLine:{data:[{type:"average",name:"平均值"}]}}]};return o.setOption(f),o}));case 5:case"end":return t.stop()}}),t)})))()},showCharts2:function(){var e=this;return c(o.default.mark((function t(){var a;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getWeatherIndex();case 2:a=t.sent,e.$refs.chart2.init((function(e){var t=e.canvas,o=n.init(t,null,e),r={tooltip:{trigger:"item",triggerOn:"click"},legend:{top:0},series:[{top:"20%",type:"pie",radius:[15,e.width/4],center:["50%","50%"],roseType:"area",itemStyle:{borderRadius:8},data:a}]};return o.setOption(r),o}));case 4:case"end":return t.stop()}}),t)})))()},showCharts3:function(){var e=this;return c(o.default.mark((function t(){var a;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getNowAirQuality();case 2:a=t.sent,e.$refs.chart3.init((function(e){var t=e.canvas,o=n.init(t,null,e),r=["#FF8700","#ffc300","#00e473","#009DFF","#ffff7f"],i=[],s=[],l=0,c=[],u=[];a.forEach((function(e,t){i.push(e.name),s.push(e.value),l+=e.value})),a.forEach((function(e,t){c.push({left:20,top:"-15%",name:"空气质量",type:"pie",clockWise:!1,hoverAnimation:!1,radius:[65-15*t+"%",57-15*t+"%"],center:["30%","50%"],label:{show:!1},data:[{value:e.value,name:e.name},{value:l-e.value,name:"",itemStyle:{color:"rgba(0,0,0,0)"}}]}),c.push({left:20,top:"-15%",name:"",type:"pie",silent:!0,z:1,clockWise:!1,hoverAnimation:!1,radius:[65-15*t+"%",57-15*t+"%"],center:["30%","50%"],label:{show:!1},data:[{value:7.5,itemStyle:{color:"#E3F0FF"}},{value:2.5,name:"",itemStyle:{color:"rgba(0,0,0,0)"}}]}),e.percent=(e.value/l*100).toFixed(1)+"%",u.push({value:t,textStyle:{rich:{circle:{color:r[t],padding:[0,5]}}}})}));var f={color:r,grid:{top:"15%",bottom:"54%",left:"-15%",containLabel:!1},yAxis:[{type:"category",inverse:!0,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{formatter:function(e){var t=a[e];return"{line|}{circle|●}{name|"+t.name+"}{bd||}{percent|"+t.percent+"   }{value|"+t.value+"}{unit|"+t.unit+"}"},interval:0,inside:!0,textStyle:{color:"#333",fontSize:12,rich:{line:{width:176,height:10,backgroundColor:"white"},name:{color:"#666",fontSize:12},bd:{color:"#ccc",padding:[0,5],fontSize:12},percent:{color:"#333",fontSize:12},value:{color:"#333",fontSize:12,fontWeight:500},unit:{fontSize:12,padding:[0,0,0,2]}},padding:[-55,0,0,10]},show:!0},data:u}],xAxis:[{show:!1}],series:c};return o.setOption(f),o}));case 4:case"end":return t.stop()}}),t)})))()},showCharts4:function(){var e=this;return c(o.default.mark((function t(){var a,r;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getMinsRian();case 2:a=t.sent,r=a.fxTime,e.$refs.chart4.init((function(e){var t=e.canvas,o=n.init(t,null,e),i={backgroundColor:"#ffffff",title:{x:"4%",textStyle:{color:"#fff",fontSize:"22"},subtextStyle:{color:"#90979c",fontSize:"16"}},tooltip:{trigger:"axis",triggerOn:"mousemove|click",axisPointer:{axis:"x",snap:!0,type:"cross",textStyle:{color:"#fff"}}},grid:{borderWidth:0,top:110,bottom:95,textStyle:{color:"#fff"}},legend:{x:"4%",top:"8%",textStyle:{color:"#90979c"},data:["降雨量","走势"]},calculable:!0,xAxis:[{type:"category",nameTextStyle:{fontSize:14},axisLine:{lineStyle:{color:"#90979c"}},splitLine:{show:!1},axisTick:{show:!1},splitArea:{show:!1},data:r}],yAxis:[{type:"value",splitLine:{show:!1},axisLine:{lineStyle:{color:"#90979c"}},axisTick:{show:!1},axisLabel:{interval:"auto"},splitArea:{show:!1}}],dataZoom:[{show:!0,height:30,xAxisIndex:[0],bottom:30,start:0,end:20,handleIcon:"path://M306.1,413c0,2.2-1.8,4-4,4h-59.8c-2.2,0-4-1.8-4-4V200.8c0-2.2,1.8-4,4-4h59.8c2.2,0,4,1.8,4,4V413z",handleSize:"110%",handleStyle:{color:"#d3dee5"},textStyle:{color:"#fff"},borderColor:"#90979c"},{type:"inside",show:!0,height:15,start:1,end:35}],series:[{name:"降雨量",type:"bar",stack:"总量",barMaxWidth:35,barGap:"10%",itemStyle:{normal:{color:"rgba(255,144,128,1)",label:{show:!0,textStyle:{color:"#fff"},position:"inside",formatter:function(e){return e.value>0?e.value:""}}}},data:a.precip},{name:"走势",type:"line",symbolSize:10,symbol:"circle",itemStyle:{normal:{color:"rgba(252,230,48,1)",barBorderRadius:0,label:{show:!0,position:"top",formatter:function(e){return e.value>0?e.value:""}}}},data:a.precip}]};return o.setOption(i),o}));case 5:case"end":return t.stop()}}),t)})))()}}};t.default=f}).call(this,a("543d")["default"])},a230:function(e,t,a){"use strict";a.r(t);var o=a("a894"),n=a("c64b");for(var r in n)"default"!==r&&function(e){a.d(t,e,(function(){return n[e]}))}(r);a("d566");var i,s=a("f0c5"),l=Object(s["a"])(n["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],i);t["default"]=l.exports},a894:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){return o}));var o={lEchart:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/lime-echart/components/l-echart/l-echart")]).then(a.bind(null,"bf55"))}},n=function(){var e=this,t=e.$createElement,a=(e._self._c,JSON.stringify(e.weatherInfo));e.$mp.data=Object.assign({},{$root:{g0:a}})},r=[]},a92e:function(e,t,a){"use strict";(function(e){a("24e4");o(a("66fd"));var t=o(a("a230"));function o(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=a,e(t.default)}).call(this,a("543d")["createPage"])},b4ee:function(e,t,a){},c64b:function(e,t,a){"use strict";a.r(t);var o=a("1c02"),n=a.n(o);for(var r in o)"default"!==r&&function(e){a.d(t,e,(function(){return o[e]}))}(r);t["default"]=n.a},d566:function(e,t,a){"use strict";var o=a("b4ee"),n=a.n(o);n.a}},[["a92e","common/runtime","common/vendor"]]]);